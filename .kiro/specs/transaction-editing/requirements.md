# Requirements Document

## Introduction

Добавление возможности редактирования существующих транзакций в панели транзакций на главном экране приложения. В настоящее время пользователи могут только создавать новые транзакции, но не могут изменять уже созданные. Это создает неудобство, когда нужно исправить ошибку в сумме, категории или описании транзакции.

## Glossary

- **TransactionsPanel**: Панель в правой части HomeView, отображающая список транзакций за выбранный день
- **TransactionModal**: Модальное окно для создания и редактирования транзакций
- **Transaction Edit Mode**: Режим работы TransactionModal для редактирования существующей транзакции
- **Transaction Create Mode**: Режим работы TransactionModal для создания новой транзакции
- **ListTile**: UI элемент Flet для отображения элемента списка с возможностью взаимодействия
- **Action Buttons**: Кнопки действий (редактировать, удалить) в строке транзакции
- **TransactionUpdate**: Pydantic модель для обновления существующей транзакции
- **HomePresenter**: Комп��нент, содержащий бизнес-логику HomeView

## Requirements

### Requirement 1

**User Story:** Как пользователь, я хочу видеть кнопки действий для каждой транзакции в списке, чтобы быстро редактировать или удалять записи.

#### Acceptance Criteria

1. WHEN транзакция отображается в списке THEN система SHALL показывать кнопки действий (редактировать, удалить) в правой части строки
2. WHEN пользователь нажимает кнопку редактирования THEN система SHALL открывать TransactionModal в режиме редактирования
3. WHEN TransactionModal открывается в режиме редактирования THEN все поля SHALL быть предзаполнены данными выбранной транзакции
4. WHEN TransactionModal открывается в режиме редактирования THEN заголовок окна SHALL отображать "Редактировать транзакцию"
5. WHEN кнопки действий отображаются THEN они SHALL иметь соответствующие иконки и tooltip для понятности

### Requirement 2

**User Story:** Как пользователь, я хочу изменить данные транзакции в модальном окне редактирования, чтобы исправить ошибки или обновить информацию.

#### Acceptance Criteria

1. WHEN пользователь изменяет сумму транзакции THEN система SHALL валидировать, что сумма положительная
2. WHEN пользователь изменяет тип транзакции (доход/расход) THEN система SHALL обновить список доступных категорий
3. WHEN пользователь изменяет категорию THEN система SHALL валидировать, что категория соответствует выбранному типу
4. WHEN пользователь изменяет дату транзакции THEN система SHALL валидировать корректность даты
5. WHEN пользователь изменяет описание THEN система SHALL принимать любой текст или пустое значение

### Requirement 3

**User Story:** Как пользователь, я хочу сохранить изменения в транзакции, чтобы обновить её в системе.

#### Acceptance Criteria

1. WHEN пользователь нажимает "Сохранить" с валидными данными THEN система SHALL обновить транзакцию в базе данных
2. WHEN транзакция успешно обновлена THEN модальное окно SHALL закрыться автоматически
3. WHEN транзакция успешно обновлена THEN список транзакций SHALL обновиться с новыми данными
4. WHEN транзакция успешно обновлена THEN календарь SHALL обновиться для отражения изменений
5. WHEN транзакция успешно обновлена THEN система SHALL показать уведомление об успешном сохранении

### Requirement 4

**User Story:** Как пользователь, я хочу отменить редактирование транзакции, чтобы закрыть модальное окно без сохранения изменений.

#### Acceptance Criteria

1. WHEN пользователь нажимает "Отмена" THEN модальное окно SHALL закрыться без сохранения изменений
2. WHEN пользователь нажимает вне модального окна THEN модальное окно SHALL закрыться без сохранения изменений
3. WHEN пользователь нажимает клавишу Escape THEN модальное окно SHALL закрыться без сохранения изменений
4. WHEN модальное окно закрывается без сохранения THEN список транзакций SHALL остаться неизменным
5. WHEN модальное окно закрывается без сохранения THEN все изменения в полях SHALL быть отброшены

### Requirement 5

**User Story:** Как пользователь, я хочу видеть валидацию данных при редактировании транзакции, чтобы избежать сохранения некорректных данных.

#### Acceptance Criteria

1. WHEN пользователь вводит отрицательную или нулевую сумму THEN система SHALL показать сообщение об ошибке валидации
2. WHEN пользователь не выбирает категорию THEN система SHALL показать сообщение об ошибке валидации
3. WHEN пользователь вводит некорректную дату THEN система SHALL показать сообщение об ошибке валидации
4. WHEN есть ошибки валидации THEN кнопка "Сохранить" SHALL быть неактивной
5. WHEN пользователь исправляет ошибки валидации THEN сообщения об ошибках SHALL исчезать автоматически

### Requirement 6

**User Story:** Как пользователь, я хочу удалить транзакцию нажатием на кнопку удаления, чтобы убрать ненужные записи.

#### Acceptance Criteria

1. WHEN пользователь нажимает кнопку удаления транзакции THEN система SHALL показать диалог подтверждения
2. WHEN пользователь подтверждает удаление THEN система SHALL удалить транзакцию из базы данных
3. WHEN транзакция успешно удалена THEN список транзакций SHALL обновиться без удаленной записи
4. WHEN транзакция успешно удалена THEN календарь SHALL обновиться для отражения изменений
5. WHEN пользователь отменяет удаление THEN диалог SHALL закрыться без изменений

### Requirement 7

**User Story:** Как разработчик, я хочу расширить TransactionModal для поддержки режима редактирования, чтобы переиспользовать существующий код.

#### Acceptance Criteria

1. WHEN TransactionModal инициализируется THEN он SHALL поддерживать параметр для режима работы (создание/редактирование)
2. WHEN TransactionModal открывается в режиме редактирования THEN он SHALL принимать объект существующей транзакции
3. WHEN TransactionModal работает в режиме редактирования THEN он SHALL использовать TransactionUpdate модель для сохранения
4. WHEN TransactionModal работает в режиме создания THEN он SHALL использовать TransactionCreate модель как раньше
5. WHEN TransactionModal сохраняет изменения THEN он SHALL вызывать соответствующий callback (on_save для создания, on_update для редактирования)

### Requirement 8

**User Story:** Как разработчик, я хочу интегрировать функциональность редактирования с HomePresenter, чтобы сохранить архитектуру MVP.

#### Acceptance Criteria

1. WHEN пользователь выбирает редактирование транзакции THEN HomeView SHALL делегировать обработку в HomePresenter
2. WHEN HomePresenter получает запрос на редактирование THEN он SHALL подготовить данные для модального окна
3. WHEN пользователь сохраняет изменения THEN HomePresenter SHALL вызвать transaction_service.update_transaction
4. WHEN обновление успешно THEN HomePresenter SHALL обновить данные через IHomeViewCallbacks
5. WHEN происходит ошибка при обновлении THEN HomePresenter SHALL показать сообщение об ошибке через callback

### Requirement 9

**User Story:** Как пользователь, я хочу видеть визуальные индикаторы для интерактивных элементов, чтобы понимать, что с ними можно взаимодействовать.

#### Acceptance Criteria

1. WHEN пользователь наводит курсор на кнопку действия THEN кнопка SHALL изменить цвет для индикации интерактивности
2. WHEN кнопка редактирования отображается THEN она SHALL иметь иконку карандаша и tooltip "Редактировать"
3. WHEN кнопка удаления отображается THEN она SHALL иметь иконку корзины и tooltip "Удалить"
4. WHEN кнопки действий отображаются THEN они SHALL быть компактными и не занимать много места в строке
5. WHEN элементы интерфейса недоступны THEN они SHALL быть визуально отключены (серый цвет, disabled состояние)

### Requirement 10

**User Story:** Как разработчик, я хочу иметь автоматические тесты для функциональности редактирования транзакций, чтобы предотвратить регрессии.

#### Acceptance Criteria

1. WHEN тесты запускаются THEN они SHALL проверить открытие модального окна в режиме редактирования
2. WHEN тесты проверяют предзаполнение полей THEN они SHALL убедиться, что все данные транзакции корректно загружены
3. WHEN тесты проверяют сохранение изменений THEN они SHALL убедиться, что update_transaction вызывается с правильными параметрами
4. WHEN тесты проверяют валидацию THEN они SHALL покрыть все сценарии ошибок валидации
5. WHEN тесты проверяют интеграцию THEN они SHALL убедиться, что UI обновляется после сохранения изменений
