# Requirements Document: Кнопка добавления отложенных платежей

## Введение

Данная спецификация описывает функциональность добавления кнопки для создания новых отложенных платежей на панели отложенных платежей главного экрана, а также исправление нерабочей кнопки "Показать всё".

## Глоссарий

- **Отложенный платёж (Pending Payment)**: Платёж, который пользователь планирует совершить в будущем, но ещё не исполнил
- **Виджет отложенных платежей (PendingPaymentsWidget)**: UI компонент на главном экране, отображающий список активных отложенных платежей
- **Модальное окно (Modal)**: Диалоговое окно для ввода данных пользователем
- **HomeView**: Главный экран приложения
- **Presenter**: Компонент, содержащий бизнес-логику (паттерн MVP)

## Требования

### Requirement 1: Кнопка добавления отложенного платежа

**User Story:** Как пользователь, я хочу иметь возможность быстро добавить новый отложенный платёж прямо с главного экрана, чтобы не переходить в отдельный раздел.

#### Acceptance Criteria

1. WHEN пользователь находится на главном экране, THE виджет отложенных платежей SHALL отображать кнопку "Добавить платёж"
2. WHEN пользователь нажимает кнопку "Добавить платёж", THE система SHALL открывать модальное окно создания отложенного платежа
3. WHEN пользователь заполняет форму и сохраняет платёж, THE система SHALL создавать новый отложенный платёж в базе данных
4. WHEN платёж успешно создан, THE система SHALL обновлять виджет отложенных платежей с новым платежом
5. WHEN платёж успешно создан, THE система SHALL показывать уведомление об успешном создании

### Requirement 2: Исправление кнопки "Показать всё"

**User Story:** Как пользователь, я хочу иметь возможность перейти к полному списку отложенных платежей, чтобы управлять всеми платежами в одном месте.

#### Acceptance Criteria

1. WHEN пользователь нажимает кнопку "Показать всё" в виджете отложенных платежей, THE система SHALL переходить к разделу "Отложенные платежи"
2. WHEN переход выполнен, THE раздел "Отложенные платежи" SHALL отображать полный список всех активных отложенных платежей
3. WHEN пользователь находится в разделе "Отложенные платежи", THE навигационная панель SHALL подсвечивать соответствующий пункт меню

### Requirement 3: Интеграция модального окна с HomeView

**User Story:** Как разработчик, я хочу правильно интегрировать модальное окно создания отложенных платежей с главным экраном, чтобы обеспечить корректную работу функционала.

#### Acceptance Criteria

1. WHEN HomeView инициализируется, THE модальное окно PendingPaymentModal SHALL быть создано с правильными callback функциями
2. WHEN пользователь сохраняет новый платёж в модальном окне, THE callback SHALL вызывать метод Presenter для создания платежа
3. WHEN Presenter создаёт платёж, THE система SHALL обновлять все зависимые компоненты (виджет, календарь)
4. WHEN происходит ошибка при создании платежа, THE система SHALL показывать сообщение об ошибке пользователю

### Requirement 4: Расположение кнопки добавления

**User Story:** Как пользователь, я хочу, чтобы кнопка добавления платежа была легко доступна и интуитивно понятна, чтобы быстро создавать новые платежи.

#### Acceptance Criteria

1. WHEN виджет отображается, THE кнопка "Добавить платёж" SHALL располагаться в заголовке виджета рядом с кнопкой "Показать всё"
2. WHEN виджет отображается, THE кнопка SHALL иметь иконку "+" (ft.Icons.ADD)
3. WHEN виджет отображается, THE кнопка SHALL иметь tooltip "Добавить отложенный платёж"
4. WHEN виджет отображается, THE кнопка SHALL быть визуально отличима от других элементов (цвет PRIMARY)

### Requirement 5: Обновление данных после создания

**User Story:** Как пользователь, я хочу сразу видеть созданный платёж в списке, чтобы убедиться, что он был успешно добавлен.

#### Acceptance Criteria

1. WHEN платёж создан, THE виджет отложенных платежей SHALL обновить список платежей
2. WHEN платёж создан, THE статистика виджета SHALL обновиться с учётом нового платежа
3. WHEN платёж создан с плановой датой, THE календарь SHALL отобразить индикатор платежа на соответствующей дате
4. WHEN платёж создан, THE модальное окно SHALL закрыться автоматически

### Requirement 6: Валидация и обработка ошибок

**User Story:** Как пользователь, я хочу получать понятные сообщения об ошибках, чтобы исправить некорректные данные.

#### Acceptance Criteria

1. WHEN пользователь пытается сохранить платёж с пустыми обязательными полями, THE система SHALL показывать сообщения об ошибках валидации
2. WHEN происходит ошибка при сохранении в базу данных, THE система SHALL показывать сообщение об ошибке
3. WHEN происходит ошибка, THE модальное окно SHALL оставаться открытым для исправления данных
4. WHEN пользователь исправляет ошибки, THE сообщения об ошибках SHALL исчезать

### Requirement 7: Навигация к разделу отложенных платежей

**User Story:** Как пользователь, я хочу иметь возможность управлять всеми отложенными платежами в отдельном разделе, чтобы видеть полную картину.

#### Acceptance Criteria

1. WHEN пользователь нажимает "Показать всё", THE система SHALL переключать активный раздел на "Отложенные платежи"
2. WHEN переход выполнен, THE MainWindow SHALL обновить отображение активного раздела
3. WHEN пользователь находится в разделе "Отложенные платежи", THE он SHALL видеть все активные, отменённые и исполненные платежи с фильтрацией

## Технические детали

### Изменения в PendingPaymentsWidget

1. Добавить кнопку "Добавить платёж" в заголовок виджета
2. Добавить callback `on_add_payment` для обработки нажатия кнопки
3. Обновить layout заголовка для размещения новой кнопки

### Изменения в HomeView

1. Обновить инициализацию `PendingPaymentModal` с правильным callback `on_save`
2. Добавить метод `on_add_pending_payment` для открытия модального окна
3. Добавить метод `on_pending_payment_saved` для обработки сохранения
4. Реализовать метод `on_show_all_payments` для навигации к разделу

### Изменения в HomePresenter

1. Добавить метод `create_pending_payment` для создания платежа через сервис
2. Обновить метод `refresh_data` для обновления виджета после создания
3. Добавить обработку ошибок при создании платежа

### Изменения в MainWindow

1. Реализовать метод навигации к разделу "Отложенные платежи"
2. Обновить обработку переключения разделов

## Зависимости

- Существующий `PendingPaymentModal` (уже реализован)
- Существующий `PendingPaymentsWidget` (требует модификации)
- Существующий `HomeView` (требует модификации)
- Существующий `HomePresenter` (требует модификации)
- Существующий `pending_payment_service` (уже реализован)
- Существующий раздел "Отложенные платежи" в MainWindow

## Ограничения

1. Модальное окно должно использовать современный Flet API (`page.open()`, `page.close()`)
2. Все изменения должны соответствовать паттерну MVP
3. Все callback должны быть правильно типизированы
4. Логирование всех операций обязательно
