# Requirements Document

## Introduction

Исправление неработающей кнопки добавления транзакции в HomeView. Пользователь сообщил, что кнопка в правом верхнем углу панели транзакций (кнопка с иконкой "+" для добавления новой транзакции) не работает при нажатии. Необходимо создать тест для проверки функциональности этой кнопки и исправить проблему.

## Glossary

- **HomeView**: Главный экран приложения с календарем, транзакциями и плановыми операциями
- **TransactionsPanel**: Панель в правой части HomeView, отображающая список транзакций за выбранный день
- **Add Transaction Button**: Кнопка с иконкой "+" в заголовке TransactionsPanel для создания новой транзакции
- **TransactionModal**: Модальное окно для создания/редактирования транзакции
- **UI Event Handler**: Функция-обработчик события нажатия на UI элемент
- **Callback Function**: Функция обратного вызова, передаваемая в компонент для обработки событий

## Requirements

### Requirement 1

**User Story:** Как пользователь, я хочу нажать на кнопку добавления транзакции в панели транзакций, чтобы открыть модальное окно создания новой транзакции.

#### Acceptance Criteria

1. WHEN пользователь нажимает на кнопку добавления транзакции THEN модальное окно TransactionModal SHALL открыться
2. WHEN модальное окно открывается THEN оно SHALL быть в режиме создания новой транзакции
3. WHEN модальное окно открывается THEN выбранная дата SHALL быть предустановлена в поле даты
4. WHEN кнопка отображается THEN она SHALL иметь иконку "+" и tooltip "Добавить транзакцию"
5. WHEN кнопка отображается THEN она SHALL быть видимой и доступной для нажатия

### Requirement 2

**User Story:** Как разработчик, я хочу иметь автоматический тест для кнопки добавления транзакции, чтобы предотвратить регрессии в будущем.

#### Acceptance Criteria

1. WHEN тест запускается THEN он SHALL проверить наличие кнопки добавления в TransactionsPanel
2. WHEN тест симулирует нажатие на кнопку THEN callback функция on_add_transaction SHALL быть вызвана
3. WHEN callback вызывается THEN TransactionModal SHALL быть открыт через page.open()
4. WHEN тест проверяет UI элементы THEN кнопка SHALL иметь корректные атрибуты (icon, tooltip, on_click)
5. WHEN тест выполняется THEN он SHALL работать изолированно с мокированными зависимостями

### Requirement 3

**User Story:** Как разработчик, я хочу проверить интеграцию между HomeView и TransactionsPanel, чтобы убедиться, что callback функции передаются корректно.

#### Acceptance Criteria

1. WHEN HomeView создается THEN TransactionsPanel SHALL получить корректную callback функцию on_add_transaction
2. WHEN callback функция вызывается THEN HomeView.open_add_transaction_modal SHALL быть выполнена
3. WHEN HomeView.open_add_transaction_modal выполняется THEN TransactionModal SHALL быть открыт с корректными параметрами
4. WHEN модальное окно открывается THEN page и selected_date SHALL быть переданы в modal.open()
5. WHEN интеграция тестируется THEN все компоненты SHALL взаимодействовать без ошибок

### Requirement 4

**User Story:** Как разработчик, я хочу использовать property-based тестирование для проверки универсальных свойств кнопки добавления, чтобы убедиться в её надежности.

#### Acceptance Criteria

1. WHEN кнопка создается с любой валидной callback функцией THEN она SHALL корректно инициализироваться
2. WHEN кнопка нажимается с любой валидной датой THEN callback SHALL получить корректную дату
3. WHEN TransactionsPanel создается с любыми валидными параметрами THEN кнопка добавления SHALL быть доступна
4. WHEN callback функция вызывается многократно THEN каждый вызов SHALL работать корректно
5. WHEN тестируются граничные случаи THEN кнопка SHALL обрабатывать их без ошибок

### Requirement 5

**User Story:** Как пользователь, я хочу полноценно работать с модальным окном добавления транзакции, чтобы создавать новые транзакции через удобный интерфейс.

#### Acceptance Criteria

1. WHEN модальное окно открывается THEN все поля формы SHALL быть доступны для заполнения (сумма, категория, описание, дата)
2. WHEN пользователь заполняет обязательные поля THEN кнопка "Сохранить" SHALL становиться активной
3. WHEN пользователь нажимает "Сохранить" с валидными данными THEN транзакция SHALL быть создана в базе данных
4. WHEN транзакция создается THEN модальное окно SHALL закрыться автоматически
5. WHEN транзакция создается THEN список транзакций в HomeView SHALL обновиться с новой транзакцией

### Requirement 6

**User Story:** Как пользователь, я хочу иметь валидацию данных в модальном окне, чтобы избежать создания некорректных транзакций.

#### Acceptance Criteria

1. WHEN пользователь оставляет поле суммы пустым THEN SHALL отображаться сообщение об ошибке валидации
2. WHEN пользователь вводит отрицательную сумму THEN SHALL отображаться сообщение об ошибке валидации
3. WHEN пользователь не выбирает категорию THEN SHALL отображаться сообщение об ошибке валидации
4. WHEN пользователь вводит некорректную дату THEN SHALL отображаться сообщение об ошибке валидации
5. WHEN есть ошибки валидации THEN кнопка "Сохранить" SHALL быть неактивной

### Requirement 7

**User Story:** Как пользователь, я хочу иметь возможность отменить создание транзакции, чтобы закрыть модальное окно без сохранения.

#### Acceptance Criteria

1. WHEN пользователь нажимает кнопку "Отмена" THEN модальное окно SHALL закрыться без сохранения данных
2. WHEN пользователь нажимает вне модального окна THEN модальное окно SHALL закрыться без сохранения данных
3. WHEN пользователь нажимает клавишу Escape THEN модальное окно SHALL закрыться без сохранения данных
4. WHEN модальное окно закрывается без сохранения THEN список транзакций SHALL остаться неизменным
5. WHEN модальное окно закрывается без сохранения THEN все введенные данные SHALL быть очищены

### Requirement 8

**User Story:** Как разработчик, я хочу проверить обработку ошибок при работе с кнопкой добавления и модальным окном, чтобы приложение было устойчивым к сбоям.

#### Acceptance Criteria

1. WHEN callback функция равна None THEN кнопка SHALL быть отключена или скрыта
2. WHEN при вызове callback возникает исключение THEN ошибка SHALL быть обработана корректно
3. WHEN TransactionModal не может быть создан THEN SHALL отображаться сообщение об ошибке
4. WHEN page недоступна THEN попытка открытия модального окна SHALL быть обработана безопасно
5. WHEN система находится в некорректном состоянии THEN кнопка SHALL не вызывать критических ошибок