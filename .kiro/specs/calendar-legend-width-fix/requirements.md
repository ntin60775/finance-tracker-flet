# Requirements Document

## Introduction

Исправление проблем с отображением календарной легенды: завышенные оценки ширины индикаторов приводят к неправильному отображению сокращённой легенды вместо полной, а кнопка "Подробнее" не работает из-за проблем с доступом к page объекту.

## Glossary

- **Calendar_Legend**: Компонент легенды календаря, показывающий значения цветовых индикаторов
- **Width_Estimation**: Оценка ширины индикаторов для определения режима отображения
- **Display_Mode**: Режим отображения легенды (полная или сокращённая)
- **Details_Button**: Кнопка "Подробнее" для открытия модального окна
- **Page_Object**: Объект страницы Flet, необходимый для работы модальных окон

## Requirements

### Requirement 1: Корректные оценки ширины индикаторов

**User Story:** Как пользователь, я хочу видеть полную легенду при достаточной ширине календаря, чтобы не нажимать дополнительные кнопки для просмотра всех индикаторов.

#### Acceptance Criteria

1. WHEN календарь имеет ширину 500px или больше, THE Calendar_Legend SHALL отображать все индикаторы в одну строку
2. THE Width_Estimation SHALL использовать реалистичные значения ширины для каждого индикатора
3. THE Width_Estimation SHALL учитывать фактические размеры текста и символов
4. WHEN все индикаторы помещаются в доступную ширину, THE Calendar_Legend SHALL НЕ показывать кнопку "Подробнее"
5. THE Calendar_Legend SHALL корректно вычислять общую требуемую ширину с учётом отступов

### Requirement 2: Работающая кнопка "Подробнее"

**User Story:** Как пользователь, я хочу, чтобы кнопка "Подробнее" открывала модальное окно с полной легендой, когда она отображается.

#### Acceptance Criteria

1. WHEN пользователь нажимает на кнопку "Подробнее", THE Details_Button SHALL открывать модальное окно
2. THE Details_Button SHALL корректно получать доступ к page объекту
3. THE Modal_Dialog SHALL отображаться с полной легендой и описаниями
4. WHEN модальное окно открыто, THE Modal_Dialog SHALL корректно закрываться при нажатии "Закрыть"
5. THE Details_Button SHALL обрабатывать ошибки доступа к page объекту без падения приложения

### Requirement 3: Оптимизированные размеры индикаторов

**User Story:** Как разработчик, я хочу, чтобы оценки ширины индикаторов соответствовали реальным размерам, чтобы логика отображения работала корректно.

#### Acceptance Criteria

1. THE Width_Estimation SHALL использовать ширину не более 50px для точечных индикаторов
2. THE Width_Estimation SHALL использовать ширину не более 60px для символьных индикаторов
3. THE Width_Estimation SHALL использовать ширину не более 55px для фоновых индикаторов
4. THE Width_Estimation SHALL включать отступы между визуальным элементом и текстом (5px)
5. THE Width_Estimation SHALL учитывать длину текстовых меток индикаторов

### Requirement 4: Улучшенное определение ширины календаря

**User Story:** Как система, я хочу точно определять ширину календаря, чтобы принимать правильные решения о режиме отображения легенды.

#### Acceptance Criteria

1. THE Calendar_Legend SHALL получать точную ширину календарного виджета
2. WHEN ширина календаря не может быть определена, THE Calendar_Legend SHALL использовать консервативную оценку
3. THE Calendar_Legend SHALL обновлять режим отображения при изменении ширины календаря
4. THE Calendar_Legend SHALL логировать информацию о вычислении ширины для отладки
5. THE Calendar_Legend SHALL использовать fallback значения при ошибках вычисления

### Requirement 5: Стабильная работа модального окна

**User Story:** Как пользователь, я хочу, чтобы модальное окно с легендой работало стабильно и не вызывало ошибок.

#### Acceptance Criteria

1. THE Modal_Dialog SHALL открываться без ошибок при любых условиях
2. THE Modal_Dialog SHALL корректно обрабатывать отсутствие page объекта
3. THE Modal_Dialog SHALL отображать все индикаторы с правильной группировкой
4. THE Modal_Dialog SHALL закрываться корректно при нажатии кнопки или клавиши Escape
5. THE Modal_Dialog SHALL логировать ошибки без прерывания работы приложения