# Implementation Plan

- [x] 1. Создать базовую инфраструктуру тестирования удаления транзакций
  - Базовые фикстуры уже существуют в conftest.py
  - Моки для сервисов и UI компонентов уже настроены
  - Вспомогательные функции для проверки состояния системы уже созданы
  - _Requirements: 1.1, 2.1, 3.1_

- [x] 2. Реализовать unit тесты для сервисного слоя удаления
  - [x] 2.1 Тесты для transaction_service.delete_transaction уже существуют
    - Тесты в test_uuid_migration_services.py и test_home_presenter.py
    - Покрывают успешное удаление, несуществующую транзакцию, ошибки БД
    - _Requirements: 4.4, 5.4_

  - [x] 2.2 Написать property тест для консистентности удаления
    - **Property 2: Transaction Count Consistency**
    - **Validates: Requirements 4.4**

  - [x] 2.3 Написать тесты для пересчета балансов после удаления
    - Тест пересчета общего баланса после удаления дохода
    - Тест пересчета общего баланса после удаления расхода
    - Тест пересчета баланса при удалении транзакции с нулевой суммой
    - _Requirements: 1.1, 4.1, 4.2, 4.3_

  - [x] 2.4 Написать property тест для сохранения баланса
    - **Property 1: Balance Conservation After Deletion**
    - **Validates: Requirements 1.1, 4.1**

- [x] 3. Реализовать unit тесты для HomePresenter
  - [x] 3.1 Тесты для метода delete_transaction уже существуют
    - Тесты в test_home_presenter.py покрывают все сценарии
    - Успешное удаление, транзакция не найдена, обработка ошибок
    - _Requirements: 5.1, 5.4, 5.5_

  - [x] 3.2 Написать тесты для метода _refresh_data
    - Тест обновления данных календаря
    - Тест обновления транзакций для выбранной даты
    - Тест обновления плановых операций
    - Тест обновления отложенных платежей
    - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5_

  - [x] 3.3 Написать property тест для синхронизации UI состояния
    - **Property 4: UI State Synchronization**
    - **Validates: Requirements 2.1, 2.2, 2.3, 2.4, 2.5**

- [x] 4. Реализовать unit тесты для UI компонентов
  - [x] 4.1 Тесты для TransactionsPanel кнопки удаления уже существуют
    - Тесты в test_transactions_panel.py покрывают все сценарии
    - Отображение кнопки, вызов callback, безопасная обработка
    - _Requirements: 3.1, 3.2_

  - [x] 4.2 Тесты для диалогов подтверждения удаления уже существуют
    - Тесты в test_transaction_editing_integration.py
    - Покрывают создание диалога, page.open(), подтверждение и отмену
    - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5_

  - [x] 4.3 Написать property тест для надежности отображения диалогов

    - **Property 5: Dialog Display Reliability**
    - **Validates: Requirements 3.1, 3.2**

  - [ ] 4.4 Написать property тест для консистентности действий диалога
    - **Property 6: Dialog Action Consistency**
    - **Validates: Requirements 3.3, 3.4**

- [x] 5. Реализовать интеграционные тесты полного цикла удаления
  - [x] 5.1 Тест полного цикла удаления через UI уже существует
    - Тест в test_transaction_editing_integration.py
    - Покрывает весь цикл от UI до БД
    - _Requirements: 5.1, 5.2, 5.3_

  - [ ] 5.2 Написать тест каскадных обновлений после удаления
    - Создание транзакции с связанными данными
    - Выполнение удаления транзакции
    - Проверка обновления TransactionsPanel
    - Проверка обновления CalendarWidget
    - Проверка обновления сводки дня
    - Проверка обновления прогноза баланса
    - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5_

  - [x] 5.3 Тест обработки ошибок при удалении уже существует
    - Тест в test_home_presenter.py покрывает rollback и сообщения об ошибках
    - _Requirements: 5.4_

- [x] 6. Реализовать регрессионные тесты для исходной проблемы
  - [x] 6.1 Тест регрессии проблемы с невидимыми диалогами уже существует
    - Код в home_view.py использует page.open() вместо page.dialog
    - Тесты в test_transaction_editing_integration.py проверяют это
    - _Requirements: 3.5_

  - [x] 6.2 Тест регрессии проблемы с кнопками уже существует
    - Тесты в test_transactions_panel.py и test_transaction_editing_properties.py
    - _Requirements: 3.1, 3.2_

- [x] 7. Реализовать property-based тесты для пересчетов
  - [x] 7.1 Написать property тест для точности пересчета прогнозов
    - **Property 7: Forecast Recalculation Accuracy**
    - **Validates: Requirements 1.2**
  - [x] 7.2 Написать property тест для консистентности статистики категорий

    - **Property 3: Category Statistics Consistency**
    - **Validates: Requirements 1.3**

- [ ] 8. Реализовать тесты производительности удаления
  - [ ] 8.1 Написать тесты производительности для больших наборов данных
    - Тест удаления транзакции из набора 1000+ транзакций
    - Измерение времени выполнения операции удаления
    - Проверка эффективности пересчетов после удаления
    - _Requirements: 6.1, 6.2_

  - [ ] 8.2 Написать property тест для консистентности производительности
    - **Property 9: Performance Consistency**
    - **Validates: Requirements 6.1, 6.2**

- [x] 9. Реализовать тесты граничных случаев
  - [x] 9.1 Написать тесты для нестандартных транзакций
    - Тест удаления транзакции с нулевой суммой
    - Тест удаления транзакции без категории
    - Тест удаления транзакции с очень большой суммой
    - Тест удаления транзакции с датой в будущем
    - Тест удаления транзакции с датой в далеком прошлом
    - _Requirements: 7.1, 7.2, 7.3, 7.4, 7.5_
  - [x] 9.2 Написать property тест для обработки граничных случаев
    - **Property 10: Edge Case Handling**
    - **Validates: Requirements 7.1, 7.2, 7.3, 7.4, 7.5**

- [x] 10. Создать специализированный файл тестов удаления транзакций
  - [x] 10.1 Создать test_transaction_deletion_comprehensive.py
    - Собрать все недостающие тесты в одном файле
    - Организовать тесты по категориям (property-based, performance, edge cases)
    - Добавить специфичные тесты для каскадных обновлений
    - _Requirements: все требования_

- [x] 11. Checkpoint - Убедиться что все тесты проходят
  - Ensure all tests pass, ask the user if questions arise.

- [x] 12. Обновить документацию по тестированию операций удаления

  - Дополнить `.kiro/steering/ui-testing.md` паттернами тестирования delete операций
  - Расширить checklist специфичными проверками для операций удаления
  - Документировать тестирование подтверждения удаления и cascade effects
  - _Requirements: все требования_