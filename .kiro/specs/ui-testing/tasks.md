# План реализации UI-тестирования

## Текущее состояние

Уже реализовано:
- ✅ Тесты для HomeView (smoke test, загрузка данных, выбор даты)
- ✅ Тесты для модальных окон: LenderModal, LoanModal, PlannedTransactionModal, TransactionModal
- ✅ Фикстура db_session в conftest.py
- ✅ Property-based тесты для бизнес-логики (сервисы)

Требуется реализовать:
- UI-тесты для остальных View компонентов
- Property-based тесты для универсальных свойств View
- Тесты навигации между View

---

- [x] 1. Создать базовый класс для тестов View
  - Создать `tests/test_view_base.py` с базовым классом `ViewTestBase`
  - Реализовать вспомогательные методы: `create_mock_page()`, `create_mock_session()`, `assert_service_called()`, `assert_modal_opened()`
  - Добавить общие setUp/tearDown методы для переиспользования
  - _Requirements: 1.1, 1.2, 1.3_

- [x] 2. Создать фабрики тестовых данных
  - Создать `tests/test_factories.py` с фабриками для всех моделей
  - Реализовать `create_test_category()`, `create_test_transaction()`, `create_test_loan()`, `create_test_lender()`, `create_test_planned_transaction()`, `create_test_pending_payment()`
  - Добавить генераторы граничных значений и edge cases
  - _Requirements: 2.3, 2.4_

- [x] 3. Реализовать тесты для CategoriesView
  - [x] 3.1 Создать `tests/test_categories_view.py`
    - Тест инициализации View
    - Тест загрузки категорий
    - Тест фильтрации по типу транзакции
    - Тест открытия модального окна создания
    - Тест открытия модального окна редактирования
    - _Requirements: 6.1, 6.2, 6.3, 6.4_
    
- [x] 3.2 Написать property-based тест для фильтрации категорий
  - **Property 4: Фильтрация данных**
  - **Validates: Requirements 3.1, 3.3, 6.2**

- [x] 4. Реализовать тесты для LendersView
  - [x] 4.1 Создать `tests/test_lenders_view.py`
    - Тест инициализации View
    - Тест загрузки займодателей
    - Тест фильтрации по типу займодателя
    - Тест открытия модального окна создания
    - Тест открытия модального окна редактирования
    - Тест ошибки при удалении займодателя с активными кредитами
    - _Requirements: 7.1, 7.2, 7.3, 7.4, 7.5_

- [x] 4.2 Написать property-based тест для валидации удаления займодателя
  - **Property: Удаление займодателя с активными кредитами должно возвращать ошибку**
  - **Validates: Requirements 7.5**

- [x] 5. Реализовать тесты для LoansView
  - [x] 5.1 Создать `tests/test_loans_view.py`
    - Тест инициализации View
    - Тест загрузки кредитов и статистики
    - Тест фильтрации по статусу кредита
    - Тест открытия модального окна создания
    - Тест навигации к LoanDetailsView
    - Тест обновления статистики
    - _Requirements: 8.1, 8.2, 8.3, 8.4, 8.5_

- [x] 5.2 Написать property-based тест для статистики кредитов

  - **Property: Статистика должна корректно рассчитываться для любого набора кредитов**
  - **Validates: Requirements 8.5**

- [x] 6. Реализовать тесты для LoanDetailsView
  - [x] 6.1 Создать `tests/test_loan_details_view.py`
    - Тест инициализации View с валидным кредитом
    - Тест загрузки деталей кредита и графика платежей
    - Тест кнопки "Назад"
    - Тест обработки несуществующего кредита
    - Тест открытия модального окна досрочного погашения
    - _Requirements: 9.1, 9.2, 9.3, 9.4, 9.5_

- [x] 7. Реализовать тесты для PendingPaymentsView
  - [x] 7.1 Создать `tests/test_pending_payments_view.py`
    - Тест инициализации View
    - Тест загрузки отложенных платежей и статистики
    - Тест выполнения платежа
    - Тест отмены платежа
    - Тест отображения пустого состояния
    - Тест обновления статистики
    - _Requirements: 10.1, 10.2, 10.3, 10.4, 10.5_

- [x] 7.2 Написать property-based тест для выполнения платежей
  - **Property: Выполнение платежа должно создавать транзакцию и удалять платеж**
  - **Validates: Requirements 10.2**

- [x] 8. Реализовать тесты для PlannedTransactionsView
  - [x] 8.1 Создать `tests/test_planned_transactions_view.py`
    - Тест инициализации View
    - Тест загрузки плановых транзакций
    - Тест фильтрации по типу транзакции
    - Тест открытия модального окна создания
    - Тест открытия модального окна редактирования
    - Тест удаления транзакции
    - _Requirements: 11.1, 11.2, 11.3, 11.4, 11.5_

- [x] 9. Реализовать тесты для PlanFactView
  - [x] 9.1 Создать `tests/test_plan_fact_view.py`
    - Тест инициализации View
    - Тест загрузки данных план-факт анализа
    - Тест изменения периода
    - Тест фильтрации по категории
    - Тест отображения пустого состояния
    - Тест расчета и форматирования отклонений
    - _Requirements: 12.1, 12.2, 12.3, 12.4, 12.5_

- [x] 9.2 Написать property-based тест для расчета отклонений
  - **Property: Отклонения должны корректно рассчитываться для любых план-факт данных**
  - **Validates: Requirements 12.5**

- [x] 10. Реализовать тесты для SettingsView
  - [x] 10.1 Создать `tests/test_settings_view.py`
    - Тест инициализации View
    - Тест загрузки текущих настроек
    - Тест изменения темы
    - Тест изменения размеров окна
    - Тест сброса настроек
    - Тест сохранения настроек
    - _Requirements: 13.1, 13.2, 13.3, 13.4, 13.5_

- [x] 11. Реализовать тесты для MainWindow
  - [x] 11.1 Создать `tests/test_main_window.py`
    - Тест инициализации MainWindow
    - Тест навигации между View через меню
    - Тест корректного закрытия View при переходе
    - Smoke test для всех пунктов меню
    - _Requirements: 5.1, 5.2, 5.3, 5.4_

- [x] 11.2 Написать property-based тест для навигации
  - **Property 8: Навигация между View**
  - **Property 9: Закрытие View при навигации**
  - **Validates: Requirements 5.1, 5.2, 5.3**

- [x] 12. Создать property-based тесты для универсальных свойств View
  - [ ] 12.1 Создать `tests/test_view_properties.py`
    - **Property 1: View инициализация** - для любого View при создании с валидными page и session должны быть установлены атрибуты и UI компоненты
    - **Property 2: Загрузка данных при инициализации** - для любого View с загрузкой данных должны вызываться соответствующие сервисы
    - **Property 3: Обновление UI после загрузки данных** - для любого View после загрузки данных UI должен отражать эти данные
    - **Property 5: Открытие модального окна создания** - для любого View с функцией создания должно открываться модальное окно
    - **Property 6: Открытие модального окна редактирования** - для любого View с функцией редактирования должно открываться модальное окно с данными
    - **Property 7: Обновление данных после закрытия модального окна** - для любого View после закрытия модалки должны перезагружаться данные
    - _Requirements: 1.1, 1.2, 1.3, 2.1, 2.2, 4.1, 4.2, 4.3, 4.4_

- [x] 13. Checkpoint - Убедиться, что все тесты проходят
  - Запустить все тесты: `pytest tests/`
  - Проверить покрытие кода: `pytest tests/ --cov=src/finance_tracker/views --cov-report=html`
  - Убедиться, что покрытие >= 80%
  - Если есть проблемы, спросить пользователя

- [x] 14. Обновить документацию по запуску тестов
  - [x] 14.1 Добавить в README.md секцию "Запуск тестов"
    - Команды для запуска всех тестов
    - Команды для запуска только UI-тестов
    - Команды для запуска property-based тестов
    - Команды для проверки покрытия
    - _Requirements: все_

