# Requirements Document

## Introduction

Реорганизация структуры проекта Finance Tracker Flet для соответствия лучшим практикам Python-разработки. Текущая структура имеет модули в корневой директории, что затрудняет масштабирование, тестирование и распространение приложения. Цель - привести проект к стандартной src-layout структуре с чёткой изоляцией компонентов.

## Glossary

- **System**: Finance Tracker Flet - десктопное приложение для учёта финансов
- **src-layout**: Стандартная структура Python-проектов, где исходный код находится в директории `src/`
- **Package**: Директория с `__init__.py`, содержащая модули Python
- **Entry Point**: Точка входа в приложение - файл, который запускается первым
- **Build Artifacts**: Файлы, создаваемые в процессе сборки (dist/, build/, .egg-info/)
- **Import Path**: Путь импорта модуля (например, `from finance_tracker.config import settings`)
- **Launcher**: Простой скрипт запуска в корне проекта для удобства разработки
- **User Data Directory**: Директория для хранения пользовательских данных (БД, логи, настройки)
- **License**: Лицензия проекта, определяющая условия использования кода
- **Git Submodule**: Механизм Git для подключения внешнего репозитория как поддиректории
- **Mobile Sync**: Функционал синхронизации данных между десктопной и мобильной версиями
- **Export/Import**: Функционал экспорта и импорта данных в файлы

## Requirements

### Requirement 1

**User Story:** Как разработчик, я хочу иметь чистую корневую директорию проекта, чтобы легко ориентироваться в структуре и не путать исходный код с конфигурационными файлами.

#### Acceptance Criteria

1. WHEN проект открывается в IDE THEN корневая директория SHALL содержать только конфигурационные файлы (pyproject.toml, README.md, .gitignore), директории src/, tests/, assets/ и опциональный launcher
2. WHEN разработчик просматривает корень проекта THEN все исходные модули Python SHALL находиться внутри src/finance_tracker/
3. WHEN выполняется сборка проекта THEN build-артефакты (dist/, build/, *.egg-info/) SHALL создаваться в корне, но SHALL быть добавлены в .gitignore
4. WHEN разработчик ищет конфигурацию приложения THEN config.py SHALL находиться в src/finance_tracker/, а не в корне проекта

### Requirement 2

**User Story:** Как разработчик, я хочу использовать стандартную src-layout структуру, чтобы избежать проблем с импортами и упростить тестирование.

#### Acceptance Criteria

1. WHEN создаётся новая структура THEN исходный код SHALL находиться в src/finance_tracker/ директории
2. WHEN выполняются импорты в коде THEN все импорты SHALL использовать полный путь от корня пакета (например, `from finance_tracker.config import settings`)
3. WHEN запускаются тесты THEN pytest SHALL корректно находить модули через установленный пакет
4. WHEN устанавливается пакет через pip THEN структура импортов SHALL оставаться неизменной

### Requirement 3

**User Story:** Как разработчик, я хочу иметь чёткую точку входа в приложение, чтобы было понятно, как запускать проект в разных режимах.

#### Acceptance Criteria

1. WHEN разработчик запускает приложение через `python -m finance_tracker` THEN приложение SHALL запускаться через __main__.py
2. WHEN разработчик запускает `python main.py` из корня THEN launcher SHALL импортировать и запускать finance_tracker.__main__
3. WHEN создаётся .exe файл THEN точка входа SHALL быть корректно указана в finance_tracker_flet.spec
4. WHEN приложение запускается THEN все пути к ресурсам (assets/, database) SHALL корректно разрешаться независимо от способа запуска

### Requirement 4

**User Story:** Как разработчик, я хочу сохранить работоспособность всех существующих функций после рефакторинга, чтобы не сломать приложение.

#### Acceptance Criteria

1. WHEN выполняется миграция структуры THEN все существующие модули SHALL быть перемещены без изменения их внутренней логики
2. WHEN обновляются импорты THEN все относительные импорты SHALL быть заменены на абсолютные от корня пакета
3. WHEN приложение запускается после рефакторинга THEN все функции (БД, UI, логирование) SHALL работать идентично предыдущей версии
4. WHEN существующие тесты запускаются THEN они SHALL проходить после обновления импортов

### Requirement 5

**User Story:** Как разработчик, я хочу обновить конфигурацию сборки, чтобы она соответствовала новой структуре проекта.

#### Acceptance Criteria

1. WHEN обновляется pyproject.toml THEN секция [tool.setuptools.packages.find] SHALL указывать where = ["src"]
2. WHEN обновляется pyproject.toml THEN точка входа SHALL быть определена как finance_tracker.__main__:main
3. WHEN обновляется finance_tracker_flet.spec THEN pathex SHALL указывать на src/finance_tracker
4. WHEN выполняется сборка .exe THEN PyInstaller SHALL корректно находить все модули и ресурсы

### Requirement 6

**User Story:** Как разработчик, я хочу обновить пути к ресурсам и базе данных, чтобы они корректно работали в новой структуре.

#### Acceptance Criteria

1. WHEN приложение определяет путь к assets THEN оно SHALL корректно находить директорию assets/ относительно корня проекта
2. WHEN приложение создаёт файл базы данных THEN путь SHALL определяться корректно как в режиме разработки, так и в .exe
3. WHEN приложение запускается из разных директорий THEN пути к ресурсам SHALL разрешаться относительно местоположения модуля, а не текущей директории
4. WHEN создаются логи и конфигурационные файлы THEN они SHALL сохраняться в правильные директории независимо от структуры проекта

### Requirement 7

**User Story:** Как пользователь приложения, я хочу, чтобы служебные файлы (база данных, логи, настройки) хранились в отдельной директории, чтобы не замусоривать корень проекта и иметь возможность легко найти/удалить пользовательские данные.

#### Acceptance Criteria

1. WHEN приложение запускается первый раз THEN оно SHALL создать директорию `.finance_tracker_data/` в домашней директории пользователя для хранения пользовательских данных
2. WHEN приложение создаёт файл базы данных THEN он SHALL сохраняться в `~/.finance_tracker_data/finance.db`
3. WHEN приложение создаёт логи THEN они SHALL сохраняться в `~/.finance_tracker_data/logs/`
4. WHEN приложение сохраняет настройки THEN файл config.json SHALL находиться в `~/.finance_tracker_data/config.json`
5. WHEN приложение работает в режиме .exe THEN пользовательские данные SHALL храниться в той же директории `~/.finance_tracker_data/`, а не рядом с .exe файлом

### Requirement 8

**User Story:** Как разработчик, я хочу иметь корректный .gitignore файл, чтобы в репозиторий не попадали временные файлы, build-артефакты и пользовательские данные.

#### Acceptance Criteria

1. WHEN создаётся .gitignore THEN он SHALL игнорировать Python-специфичные файлы (__pycache__/, *.pyc, *.pyo, *.pyd)
2. WHEN создаётся .gitignore THEN он SHALL игнорировать build-артефакты (dist/, build/, *.egg-info/, *.spec)
3. WHEN создаётся .gitignore THEN он SHALL игнорировать IDE-специфичные файлы (.vscode/, .idea/, *.swp)
4. WHEN создаётся .gitignore THEN он SHALL игнорировать файлы тестирования (.pytest_cache/, .coverage, htmlcov/, .hypothesis/)
5. WHEN создаётся .gitignore THEN он SHALL игнорировать пользовательские данные (*.db, *.log, config.json)
6. WHEN создаётся .gitignore THEN он SHALL игнорировать виртуальные окружения (venv/, .venv/, env/)

### Requirement 9

**User Story:** Как автор проекта, я хочу использовать строгую open-source лицензию с копилефтом, чтобы любые модификации кода оставались открытыми, включая использование в сетевых сервисах.

#### Acceptance Criteria

1. WHEN создаётся LICENSE файл THEN он SHALL использовать лицензию GNU Affero General Public License v3.0 (AGPL-3.0)
2. WHEN пользователь читает LICENSE THEN лицензия SHALL требовать открытия исходного кода всех производных работ
3. WHEN пользователь читает LICENSE THEN лицензия SHALL требовать открытия кода даже при использовании через сеть (network copyleft)
4. WHEN пользователь читает LICENSE THEN лицензия SHALL требовать сохранения копирайтов и указания авторства (BarykinME)
5. WHEN создаётся LICENSE THEN в файле SHALL быть указан год создания и имя автора (Copyright 2024 BarykinME)

### Requirement 10

**User Story:** Как разработчик, я хочу подготовить структуру для мобильной версии с разделением на публичный и приватный код, чтобы базовый функционал был открытым, а расширенные возможности синхронизации - закрытыми.

#### Acceptance Criteria

1. WHEN создаётся структура проекта THEN директория src/finance_tracker/mobile/ SHALL содержать заглушки для мобильного функционала
2. WHEN создаётся структура проекта THEN директория src/finance_tracker/mobile/sync_proprietary/ SHALL быть настроена как Git submodule, указывающий на приватный репозиторий
3. WHEN разработчик клонирует проект без submodules THEN приложение SHALL работать с базовым функционалом, используя публичные заглушки
4. WHEN разработчик клонирует проект с submodules THEN приложение SHALL иметь доступ к расширенному функционалу синхронизации
5. WHEN создаются заглушки мобильного функционала THEN они SHALL включать базовый экспорт/импорт в файлы (публичный код)
6. WHEN создаётся submodule THEN .gitmodules файл SHALL корректно указывать путь к приватному репозиторию

### Requirement 11

**User Story:** Как разработчик, я хочу иметь актуальную документацию по структуре проекта, чтобы новые участники команды могли быстро разобраться.

#### Acceptance Criteria

1. WHEN создаётся новая структура THEN README.md SHALL содержать описание организации директорий
2. WHEN разработчик читает документацию THEN она SHALL объяснять, как запускать приложение в режиме разработки
3. WHEN разработчик читает документацию THEN она SHALL объяснять, как собирать .exe файл
4. WHEN разработчик читает документацию THEN она SHALL содержать примеры команд для установки зависимостей и запуска тестов
5. WHEN разработчик читает README.md THEN он SHALL видеть информацию о лицензии и условиях использования
6. WHEN разработчик читает README.md THEN он SHALL видеть инструкции по работе с Git submodules для расширенного функционала
